#!/usr/bin/env zsh

# --- Configuration ---
subsystem="xyz.hribar.nukelogi"
default_range="1d"

# --- 0. Sudo Refresh ---
# Ask for password upfront so the UI doesn't break later
sudo -v

# --- 1. Handle Input Parameter ---
# Use the first argument if provided, otherwise use default
range="${1:-${default_range}}"

# --- 2. Validate Input ---
if [[ ! "${range}" =~ ^[1-9][0-9]*[mhd]\|boot$ ]]; then
  echo "‚ùå Error: Invalid time format '${range}'"
  echo "Usage: ${0:t} [time]"
  echo "Examples: 10m (minutes), 4h (hours), 2d (days), boot. No 0m allowed."
  exit 1
fi

# --- 3. Checking Service Status
echo "‚öôÔ∏è  Service Status:"
if ! sudo launchctl list | grep "${subsystem}" ; then
  echo "   (Not loaded)"
fi
echo "--------------------------------------------------------------------------"

# --- 4. Execute Log Search ---
echo "üîç Searching logs for subsystem '${subsystem}' (Last: ${range})..."
echo "--------------------------------------------------------------------------"
/usr/bin/log show --predicate "subsystem == '${subsystem}'" --style syslog --last "${range}"
